---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import { Hero } from '../components/Hero';
import { SkillGallery } from '../components/SkillGallery';
import { parseSkillId, createExcerpt } from '../content.config';

const skills = await getCollection('skills');
const skillData = skills.map(s => {
  const { group, slug } = parseSkillId(s.id);
  return {
    name: s.data.name,
    description: s.data.description,
    group,
    slug,
    excerpt: createExcerpt(s.data.description),
    license: s.data.license,
  };
});

// Sort alphabetically by name
skillData.sort((a, b) => a.name.localeCompare(b.name));

const baseUrl = import.meta.env.BASE_URL.replace(/\/$/, '');
---

<Layout title="Devkit | Skills Gallery">
  <a
    href="#main-content"
    class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4
           focus:z-50 focus:px-4 focus:py-2 focus:bg-white focus:text-zinc-900
           focus:rounded focus:outline-none"
  >
    Skip to main content
  </a>

  <header class="sticky top-0 z-40 border-b border-zinc-800/50 bg-zinc-950/80 backdrop-blur-xl px-8 py-4">
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-xl font-bold">Devkit</h1>
      </div>
      <div class="flex items-center gap-4">
        <span class="text-sm text-zinc-500">{skillData.length} skills</span>
      </div>
    </div>
  </header>

  <Hero skillCount={skillData.length} />

  <main id="main-content" class="px-8 py-8">
    <SkillGallery skills={skillData} baseUrl={baseUrl} client:visible />
  </main>
</Layout>
